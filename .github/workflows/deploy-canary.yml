name: Canary Release

on: push
  # pull_request:
  #   branches:
  #     - master
  #   types:
  #     - closed

jobs:
  test:
    name: Deploy
    runs-on: ubuntu-latest
    # if: github.event.pull_request.merged

    steps:
    - uses: actions/checkout@v1
    - name: Set up Node (10)
      uses: actions/setup-node@v1
      with:
        node-version: 10.x
        registry-url: 'https://wombat-dressing-room.appspot.com/firebase/_ns/'
    # - name: Yarn install
    #   run: yarn
    # - name: yarn build
    #   run: yarn build
    - name: Deploy canary
      run: |
        npm config set //wombat-dressing-room.appspot.com/firebase/_ns/:_authToken $NPM_TOKEN_FIREBASE
        # npm config set //wombat-dressing-room.appspot.com/@firebase/analytics/_ns/:_authToken $NPM_TOKEN_ANALYTICS
        sleep 10
        npm config ls
        # yarn release --canary
      env:
        CI: true
        NPM_TOKEN_FIREBASE: ${{ secrets.NPM_TOKEN_FIREBASE }}
        NPM_TOKEN_ANALYTICS: ${{ secrets.NPM_TOKEN_ANALYTICS }}